# ==============================================================================
# Nexus COS - Plesk Additional Nginx Directives for n3xuscos.online
# ==============================================================================
# File location: /var/www/vhosts/system/n3xuscos.online/conf/vhost_nginx.conf
# 
# This file contains additional nginx directives that override Plesk's default
# configuration for the n3xuscos.online domain. Place this content in the
# "Additional nginx directives" field in Plesk or directly in the vhost file.
# ==============================================================================

# ==============================================================================
# Main Landing Page
# ==============================================================================
location = / {
    try_files $uri $uri/ /index.html;
}

# ==============================================================================
# SPA Sections - apex, beta, core
# ==============================================================================
location ^~ /apex/ {
    alias /var/www/vhosts/n3xuscos.online/httpdocs/apex/;
    try_files $uri $uri/ /index.html =404;
}

location ^~ /beta/ {
    alias /var/www/vhosts/n3xuscos.online/httpdocs/beta/;
    try_files $uri $uri/ /index.html =404;
}

location ^~ /core/ {
    alias /var/www/vhosts/n3xuscos.online/httpdocs/core/;
    try_files $uri $uri/ =404;
    add_header Access-Control-Allow-Origin "https://n3xuscos.online" always;
    add_header Access-Control-Allow-Credentials "true" always;
}

# ==============================================================================
# API Proxy - Backend Service (Port 3000)
# ==============================================================================
location ^~ /api/ {
    proxy_pass http://127.0.0.1:3000/;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}

# ==============================================================================
# Python Backend (Optional) - Port 3001
# ==============================================================================
# Uncomment if using Python backend on port 3001
# location ^~ /py/ {
#     proxy_pass http://127.0.0.1:3001/;
#     proxy_http_version 1.1;
#     proxy_set_header Host $host;
#     proxy_set_header X-Real-IP $remote_addr;
#     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#     proxy_set_header X-Forwarded-Proto $scheme;
# }

# ==============================================================================
# Streaming Service (Port 3043)
# ==============================================================================

# Streaming endpoint with WebSocket support
location ^~ /stream/ {
    proxy_pass http://127.0.0.1:3043/stream/;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_read_timeout 86400;
}

# HLS streaming endpoint
location ^~ /hls/ {
    proxy_pass http://127.0.0.1:3043/hls/;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}
