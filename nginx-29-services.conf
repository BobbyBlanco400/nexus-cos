# Nexus COS - Nginx Configuration for 33 Services
# Beta Launch Configuration (29 + 4 V-Suite Pro Services)

# Upstream definitions for all 33 services
# Phase 1: Core Infrastructure
upstream backend-api {
    server localhost:3001;
}

upstream ai-service {
    server localhost:3010;
}

upstream key-service {
    server localhost:3014;
}

# Phase 2: PUABO Ecosystem - Core Platform
upstream puaboai-sdk {
    server localhost:3012;
}

upstream puabomusicchain {
    server localhost:3013;
}

upstream pv-keys {
    server localhost:3015;
}

upstream streamcore {
    server localhost:3016;
}

upstream glitch {
    server localhost:3017;
}

# Phase 2: PUABO-DSP Services
upstream puabo-dsp-upload-mgr {
    server localhost:3211;
}

upstream puabo-dsp-metadata-mgr {
    server localhost:3212;
}

upstream puabo-dsp-streaming-api {
    server localhost:3213;
}

# Phase 2: PUABO-BLAC Services
upstream puabo-blac-loan-processor {
    server localhost:3221;
}

upstream puabo-blac-risk-assessment {
    server localhost:3222;
}

# Phase 2: PUABO-Nexus Services
upstream puabo-nexus-ai-dispatch {
    server localhost:3231;
}

upstream puabo-nexus-driver-app-backend {
    server localhost:3232;
}

upstream puabo-nexus-fleet-manager {
    server localhost:3233;
}

upstream puabo-nexus-route-optimizer {
    server localhost:3234;
}

# Phase 2: PUABO-Nuki Services
upstream puabo-nuki-inventory-mgr {
    server localhost:3241;
}

upstream puabo-nuki-order-processor {
    server localhost:3242;
}

upstream puabo-nuki-product-catalog {
    server localhost:3243;
}

upstream puabo-nuki-shipping-service {
    server localhost:3244;
}

# Phase 3: Platform Services
upstream auth-service {
    server localhost:3301;
}

upstream content-management {
    server localhost:3302;
}

upstream creator-hub {
    server localhost:3303;
}

upstream user-auth {
    server localhost:3304;
}

upstream kei-ai {
    server localhost:3401;
}

upstream nexus-cos-studio-ai {
    server localhost:3402;
}

upstream puaboverse {
    server localhost:3403;
}

upstream streaming-service {
    server localhost:3404;
}

# Phase 4: Specialized Services
upstream boom-boom-room-live {
    server localhost:3601;
}

# Phase 5: V-Suite Pro Services
upstream v-caster-pro {
    server localhost:3501;
}

upstream v-prompter-pro {
    server localhost:3502;
}

upstream v-screen-pro {
    server localhost:3503;
}

upstream v-screen-hollywood {
    server localhost:3504;
}

server {
    listen 80;
    listen [::]:80;
    server_name nexuscos.online www.nexuscos.online;

    # Security headers
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;

    # Phase 1: Core Infrastructure Routes
    location /api/backend/ {
        proxy_pass http://backend-api/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    location /api/ai/ {
        proxy_pass http://ai-service/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    location /api/keys/ {
        proxy_pass http://key-service/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # Phase 2: PUABO Core Platform Routes
    location /api/puabo/sdk/ {
        proxy_pass http://puaboai-sdk/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    location /api/puabo/musicchain/ {
        proxy_pass http://puabomusicchain/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    location /api/puabo/pv-keys/ {
        proxy_pass http://pv-keys/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    location /api/puabo/streamcore/ {
        proxy_pass http://streamcore/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    location /api/puabo/glitch/ {
        proxy_pass http://glitch/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # Phase 2: PUABO-DSP Routes
    location /api/puabo-dsp/upload/ {
        proxy_pass http://puabo-dsp-upload-mgr/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        client_max_body_size 500M;
    }

    location /api/puabo-dsp/metadata/ {
        proxy_pass http://puabo-dsp-metadata-mgr/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    location /api/puabo-dsp/streaming/ {
        proxy_pass http://puabo-dsp-streaming-api/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # Phase 2: PUABO-BLAC Routes
    location /api/puabo-blac/loans/ {
        proxy_pass http://puabo-blac-loan-processor/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    location /api/puabo-blac/risk/ {
        proxy_pass http://puabo-blac-risk-assessment/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # Phase 2: PUABO-Nexus Routes
    location /api/puabo-nexus/dispatch/ {
        proxy_pass http://puabo-nexus-ai-dispatch/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    location /api/puabo-nexus/driver/ {
        proxy_pass http://puabo-nexus-driver-app-backend/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    location /api/puabo-nexus/fleet/ {
        proxy_pass http://puabo-nexus-fleet-manager/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    location /api/puabo-nexus/routes/ {
        proxy_pass http://puabo-nexus-route-optimizer/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # Phase 2: PUABO-Nuki Routes
    location /api/puabo-nuki/inventory/ {
        proxy_pass http://puabo-nuki-inventory-mgr/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    location /api/puabo-nuki/orders/ {
        proxy_pass http://puabo-nuki-order-processor/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    location /api/puabo-nuki/catalog/ {
        proxy_pass http://puabo-nuki-product-catalog/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    location /api/puabo-nuki/shipping/ {
        proxy_pass http://puabo-nuki-shipping-service/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # Phase 3: Platform Services Routes
    location /api/auth/ {
        proxy_pass http://auth-service/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    location /api/content/ {
        proxy_pass http://content-management/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    location /api/creator/ {
        proxy_pass http://creator-hub/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    location /api/user-auth/ {
        proxy_pass http://user-auth/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    location /api/kei-ai/ {
        proxy_pass http://kei-ai/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    location /api/studio-ai/ {
        proxy_pass http://nexus-cos-studio-ai/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    location /api/puaboverse/ {
        proxy_pass http://puaboverse/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    location /api/streaming/ {
        proxy_pass http://streaming-service/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # Phase 4: Specialized Services Routes
    location /api/boom/ {
        proxy_pass http://boom-boom-room-live/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # Frontend static files (if applicable)
    location / {
        root /var/www/nexus-cos;
        try_files $uri $uri/ /index.html;
        index index.html;
    }

    # Phase 5: V-Suite Pro Services Routes
    location /v-suite/caster/ {
        proxy_pass http://v-caster-pro/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    location /v-suite/prompter/ {
        proxy_pass http://v-prompter-pro/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    location /v-suite/screen/ {
        proxy_pass http://v-screen-pro/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    location /v-suite/hollywood/ {
        proxy_pass http://v-screen-hollywood/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # Health check endpoint for load balancer
    location /health {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
    }
}
