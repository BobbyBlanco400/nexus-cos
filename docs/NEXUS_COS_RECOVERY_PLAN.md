# Nexus COS Recovery Plan
Date: 2025-09-29

## Server Information
- **Production IP**: 74.208.155.161
- **User Access**: root
- **Domains**: 
  - nexuscos.online
  - beta.nexuscos.online

## Recovery Steps

### 1. SSL Certificate Recovery
✨ **TRAE Solo Automated Fix Available**

#### Certificate Setup
1. **Secure Storage**
   ```bash
   /root/secure-ssl-keys/
   ├── prod_privkey.pem (600)
   └── beta_privkey.pem (600)
   ```

2. **Final Certificate Locations**
   ```bash
   /etc/ssl/ionos/
   ├── privkey.pem (600)
   ├── fullchain.pem (644)
   └── beta.nexuscos.online/
       ├── privkey.pem (600)
       └── fullchain.pem (644)
   ```

### 2. Service Recovery

#### Core Services
- PM2 Configuration: `/opt/nexus-cos/pm2.config.js`
- Docker Alternative: `/opt/nexus-cos/docker-compose.yml`

#### Critical Ports
- Frontend: 3000
- Backend API: 3001
- AI Service: 3010
- Key Service: 3014
- Monitoring: 9090

## Execution Plan

### Phase 1: SSL Recovery
1. Create secure key directory
2. Upload private keys
3. Verify key permissions
4. Move keys to Nginx directories
5. Validate SSL certificates
6. Test Nginx configuration
7. Reload Nginx service

### Phase 2: Service Restoration
1. Start core services via PM2/Docker
2. Verify service ports
3. Check HTTPS accessibility
4. Validate service health

## Monitoring Points

### SSL Verification
```bash
# Production
openssl s_client -connect nexuscos.online:443 -tls1_2
# Beta
openssl s_client -connect beta.nexuscos.online:443 -tls1_2
```

### Service Health
```bash
# Check running services
ss -tulnp | grep -E '3000|3001|3010|3014|9090'

# PM2 Status
pm2 status
```

## Recovery Validation

### SSL Checks
- Certificate presence
- Private key validation
- Permission verification
- HTTPS accessibility

### Service Checks
- Port availability
- Service responsiveness
- Health endpoint status
- Log verification

## Post-Recovery Tasks

### 1. Security Verification
- Validate SSL certificate chain
- Check security headers
- Verify file permissions
- Test HTTPS redirects

### 2. Service Validation
- Test all service endpoints
- Verify service intercommunication
- Check monitoring systems
- Validate logging

### 3. Documentation
- Update SSL certificate locations
- Document service configurations
- Record recovery steps taken
- Update monitoring setup

## Recovery Log Location
- Primary Log: `/root/trae_ssl_fix.log`
- Nginx Logs: `/var/log/nginx/`
- Service Logs: PM2/Docker logs

## Important Notes
1. **Backup Required**: Ensure backup of existing SSL files
2. **Permission Critical**: Maintain 600 for private keys
3. **Service Order**: Follow strict service start order
4. **Monitoring**: Keep track of all recovery steps in log

## Support Information
- Server: 74.208.155.161
- Access: Root required
- Recovery Script: TRAE Solo SSL Fix
- Log File: `/root/trae_ssl_fix.log`

---
Generated by Trae AI
Recovery script version: TRAE Solo Automated SSL + Nginx + Services Fix